# Домашнее задание. Тесты

## О моем приложении и его текущем состоянии:
Приложение состоит из клиента на реакте и сервера на Node.js:
- Клиент лежит в папке 'client'. Клиент сделан на реакте и изменения состояний на странице сделаны через хуки useState. В каждом компоненте реализована логика запросов к серверу. Это неправильно, были замечания у проверяющего в дз по React. Все из-за того, что плохо разобралась с темой архитектура React'а, и далее уже не было времени исправлять. Рефакторинг клиента я оцениваю в 30 часов - разобраться с redux, прикрутить, отладить ошибки, доделать ту функциональность, которая сейчас не работает из-за плохой архитектуры. 
Например, на странице settings не знаю как отобразить текущие настройки в полях input, если они уже есть. Вроде бы можно получить с сервера данные, но не знаю как в текущей архитектуре их передать, и чтобы не было бесконечных циклов и чтобы вводимые пользователем данные не затирались теми, которые уже на сервере хранятся.
- Сервер - это по сути прокси между клиентом и базой данных, который еще может клонировать репозиторий и искать по нему некоторые данные. 

## какие сценарии вы проверяете интеграционными тестами? +обоснование
Интеграционные тесты написаны с помощью hermione. Проверяется работа клиента на реакте в связке с Node.js-сервером, все на реальной базе данных. 
Когда я начала писать тесты, то поняла, что в моей архитектуре невозможно даже написать заглушки (stub), потому что много монолитных функций. На клиенте я выделила запросы к серверу в controller.js, но не понимаю, как куда писать заглушку для тестов. Поэтому пункт с написанием заглушек - можно считать проваленным.

В итоге, нарисовалась следующая картина. Чтобы написать хорошие тесты, с заглушками, и не сломать ничего (а уже поломала и день чинила приложение, после рефакторинга с controller.js), нужно сначала переделать архитектуру. С этим большие проблемы (как писала см.выше) и 30 дополнительных часов уже нет. 
Чтобы показать, что мне удалось разобраться с написанием тестов на hermione, я решила написать тесты на то, что точно работает - это стартовая страница.
Сценарий:
1) при открытии домашней страницы открывается стартовая страница и проверяется наличие различных элементов на ней
- header
- footer
- copyright
- button settings
- button open settings
- и др
2) при открытии домашней страницы ждем появления кнопки open settings, нажимаем на нее. Должна открыться страница settings
3) при открытии домашней страницы ждем появления кнопки settings, нажимаем на нее. Должна открыться страница settings

Тестовые сценарии, которые я бы написала, если бы сервер работал (но их нет):
1) у пользователя уже указаны настройки. Он вводит новые настройки, нажимает Save, переходит на страницу с историей билдов, возвращается на страницу c настройками и видит измененные настройки. Здесь мы проверяем, что запрос отправился на сервер, был обработан, сохранен в БД.
2) пользователь ввел commit hash на странице с историей билдов, нажал Build. Коммит появился в списке билдов.
3) пользователь ввел commit hash на странице с историей билдов, нажал Build. После появления коммита на странице билдов кликаем на появившийся билд, должна открыться страница с билдом, дожидаемся появления лога билда.
4) пользователь вводит в поле настроек, поле build command невалидные и опасные команды, например, rm -rf, ничего не должно выполняться. 



## из каких логических блоков состоит ваше приложение и какие их сценарии вы проверяете модульными тестами? +обоснование
Архитектура очень плохая, поэтому тестировать трудно. 
- функции неатомарны, отвечают за множество разных действий. 
- запросы к API сервера и к API базы данных не вынесены в отдельные методы, есть нечто похожее на контроллер, но как будто бы он неправильно написан. Невозможно сделать stub без масштабного рефакторинга.
- отсутствует redux, поэтому в коде клиента нет разделения между логикой приложения и отображением. 
- сайд эффекты присутствуют в компонентах реакт приложения (useState вместо useEffect повсеместно), поэтому затруднительно написать модульные тесты на реакт без рефакторинга.

Во всем коде можно выделить несколько блоков, которые точно работают и которые можно покрыть модульными тестами:
- функция конвертации даты и времени в реакт приложении (клиент)
- функции-утилиты в server_utils (сервер)

## как запустить тесты?

### Запуск интеграционных тестов
```
npm install
```
В отдельной консоли (запустить селениум-сервер):
```
selenium-standalone start
```
Еще в одной отдельной консоли (запустить node.js сервер моего приложения, нужно задать API_TOKEN в файле .env):
```
node server/server
```
В третьей консоли (запустить клиент на реакте):
```
cd client
npm start
```
В другой консоли (запуск интеграционных тестов):
```
.\node_modules\.bin\hermione  .\tests\integration\
```

### Запуск модульных тестов
```
mocha .\tests\unit\
```

Результаты отобразятся в консоли.